!function(a){function b(){return"1"===s.attr("data-available")&&s.is(":checked")?!0:!1}function c(){a.wpmdb.do_action("wpmdb_enable_table_migration_options"),t.hide()}function d(){t.show()}function e(){return"false"===wpmdb_data.is_multisite||"savefile"!==wpmdb_migration_type()?(c(),void r.hide()):(b()?(d(),i()):c(),void r.show())}function f(){""===u.val()?v.hide():v.show()}function g(){var c=b();a.wpmdb.do_action("wpmdbmst_subsite_export_changed",c)}function h(){var a={};if(b()){var c=u.find("option:selected").val();""===c?a=!1:(a.blog_id=c,a.domain_and_path=u.find("option:selected").text())}return a}function i(){var b=h();a.wpmdb.do_action("wpmdbmst_selected_subsite_changed",b)}function j(){a.wpmdb.do_action("wpmdb_refresh_table_selects"),"savefile"===wpmdb_migration_type()&&a.wpmdb.do_action("wpmdb_update_push_table_select"),b()?(a.wpmdb.do_action("wpmdb_disable_table_migration_options"),x&&a.wpmdb.do_action("wpmdb_select_all_tables")):a.wpmdb.do_action("wpmdb_enable_table_migration_options")}function k(b){var c=y;void 0!==b&&(void 0!==b.domain_and_path&&(c="//"+b.domain_and_path),!0===z?a('.replace-row.pin .replace-right-col input[type="text"]').val(c):a('.replace-row.pin .old-replace-col input[type="text"]').val(c))}function l(a,b){return String(a).replace(new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\"+(b||"")+"-]","g"),"\\$&")}function m(a,b,c){if((a+b).toLowerCase()===c.toLowerCase())return!0;var d=l(c),e=new RegExp(a+"([0-9]+)_"+b,"i"),f=e.exec(d);return null!=f}function n(a,b){var c=h();if(void 0!==c.blog_id){if(!(1<c.blog_id)){var d=l(b),e=new RegExp(a+"([0-9]+)_","i"),f=e.exec(d);return null==f}a=a+c.blog_id+"_";var g=b.toLowerCase().indexOf(a.toLowerCase());if(0===g)return!0}return!1}function o(c,d){if("false"===wpmdb_data.is_multisite||"savefile"!==wpmdb_migration_type())return c;if(b()){if(!1===h())return!0;if(d.substr(0,A.length)!==A)return!0;if(m(A,"users",d)||m(A,"usermeta",d))return c;var e=["blog_versions","blogs","registration_log","signups","site","sitemeta"];a.each(e,function(a,b){m(A,b,d)&&(c=!0)}),!1===n(A,d)&&(c=!0)}return c}function p(a){var b=l(a),c=new RegExp("[^a-z0-9_]","i"),d=c.exec(b);return null==d}function q(a){if("false"===wpmdb_data.is_multisite||"savefile"!==wpmdb_migration_type()||!1===b())return a;var c=w.val();return!1===h()?(alert(wpmdbmst_strings.please_select_a_subsite),a=!1):0===c.trim().length?(alert(wpmdbmst_strings.please_enter_a_prefix),a=!1):!1===p(c)&&(alert(wpmdbmst_strings.new_prefix_contents),a=!1),a}var r=a(".multisite-tools-options"),s=a("#multisite-subsite-export"),t=a(".multisite-tools-options .expandable-content"),u=a("#select-subsite"),v=a(".new-prefix-field"),w=a("#new-prefix"),x=!1,y=null,z=!1,A=a(".table-select-wrap .table-prefix").text();a.wpmdb.add_action("move_connection_info_box",function(b){A=a(".table-select-wrap .table-prefix").text(),null===y&&(y=a.wpmdb.apply_filters("wpmdb_base_old_url")),"undefined"!=typeof b.migration_type&&"undefined"!=typeof b.last_migration_type&&("savefile"===b.migration_type?"pull"===b.last_migration_type&&(z=!0):"savefile"===b.last_migration_type&&a('.replace-row.pin .old-replace-col input[type="text"]').val(y)),e(),wpmdb_toggle_migration_action_text(),a.wpmdb.do_action("wpmdb_refresh_table_selects"),z=!1}),a.wpmdb.add_action("wpmdbmst_subsite_export_changed",i),a.wpmdb.add_action("wpmdbmst_selected_subsite_changed",j),a.wpmdb.add_action("wpmdbmst_selected_subsite_changed",k),a.wpmdb.add_action("wpmdbmst_selected_subsite_changed",f),a.wpmdb.add_filter("wpmdb_exclude_table",o),a.wpmdb.add_filter("wpmdb_migration_profile_ready",q),a(document).ready(function(){a("body").on("change","#multisite-subsite-export",function(){g()}),a("body").on("change","#select-subsite",function(){i()}),e(),x=!0})}(jQuery);